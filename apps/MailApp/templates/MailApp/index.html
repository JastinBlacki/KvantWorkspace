{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
     <!-- Иконки расширений файлов -->
    {% include "SystemModule/HeadSetup/index.html" %}
    <link rel='stylesheet' href='{% static "SystemModule/icons/files/file_icons.css" %}' />
    <link rel="stylesheet" href='{% static "MailApp/highlight.css" %}'>
    <link rel="stylesheet" href='{% static "MailApp/ql-editor.css" %}'>
    <link rel="stylesheet" href='{% static "MailApp/style.css" %}'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.9/dist/katex.min.css" integrity="sha384-r/BYDnh2ViiCwqZt5VJVWuADDic3NnnTIEOv4hOh05nSfB6tjWpKmn1kUHOVkMXc" crossorigin="anonymous">  <!-- Стили для отображения формул -->
    <title>Почта</title>
</head>

<body onload='getNewMails()'>
    <!-- Навигационное меню -->
    {% include "SystemModule/AsideMenu/index.html" with user=user active='mail' %}
    <!-- Шапка -->
    <header>
        <div class='page-header'>
            <span class="fi fi-rr-envelope" style='font-size: 1.5rem'><h1 style='display: inline-block; margin-left: 5px;'>Почта</h1></span>
            <div class="main-btn"><button onclick="open_form('#mail-form')">Написать</button></div>
        </div>
        {% include "SystemModule/ToolbarMenu/index.html" with user=user %}
    </header>
    <!-- Почта -->
    <section id="mail">
        <main>
            <div class='day' id='mail_container'>
                <!-- Тут спавнятся письма -->
            </div>
            <!-- Кнопка "Больше писем" -->
            <div id="more-mails" class='main-btn' style='margin-top: 25px;'>
                <button onclick="getNewMails()">Больше писем</button>
            </div>
        </main>
        <img src='{% static "SystemModule/atom.png" %}' class='bg'/>
        <!-- Форма создания письма -->
        <div class='form' id='mail-form'>
            <div class="form-wrapper">
                <div class="forms__container">
                    <form>
                        <div class="item-header">
                            <input placeholder="Поиск пользователей" onkeyup="filterFunction(this)" class='dropdown-input'>
                            <button class='filter-button active' type="button" onclick="filter_applying(this, 'Ученик')"><i class="fi-rr-backpack"></i></button>
                            <button class='filter-button active' type="button" onclick="filter_applying(this, 'Учитель')"><i class="fi-rr-graduation-cap"></i></button>
                            <button class='filter-button active' type="button" onclick="filter_applying(this, 'Группа')"><i class="fi-rr-physics"></i></button>
                            <button class='filter-button active' type="button" onclick="filter_applying(this, 'Администратор')"><i class="fi-rr-crown"></i></button>
                        </div>
                        <div class="users unselected" style='display: none'>
                            {% for kvant_user in users %}
                            {% if kvant_user != user %}
                            <div class="user draggable" value='{{ kvant_user.id }}'>
                                <img src='{{ kvant_user.image.url }}'/>
                                <div class="info">
                                    <h4>{{ kvant_user.permission }}</h4>
                                    <h2>{{ kvant_user.surname }}
                                        {{ kvant_user.name|slice:"1" }}.
                                        {{ kvant_user.patronymic|slice:"1" }}.
                                    </h2>
                                </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </form>
                    <form>
                        <div class='item-header'>
                            <h1>Получатели</h1>
                            <button class='form-btn' type="button" id='send-mail'><span class="fi-rr-paper-plane"></span>Отправить</button>
                        </div>
                        <div class="users selected">
                            <!-- Место для выбранных пользователей -->
                        </div>
                        <input id='mail-title' class='text-field text-field-title' autocomplete="off" placeholder="Тема"></input>
                        <div id="editor" class='text-field'></div>
                        <button class='form-btn' id='mail-file' type="button"><span class="fi-rr-clip"></span>Документ</button>
                        <input type="file" style="display: none" id='file-input' onchange="addNewFile(event)">
                        <div class='files' id='file-container'>
                            <!-- Спавн файлов -->
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    {% include "SystemModule/ScriptsSetup/index.html" with user=user %}
    <!-- Подсветка кода -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <!-- Сама панель инструментов -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <!-- Отображение математических формул -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.9/dist/katex.min.js" integrity="sha384-zDIgORxjImEWftZXZpWLs2l57fMX9B3yWFPN5Ecabe211Hm5ZG/OIz2b07DYPUcH" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.9/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <!-- Библиотека для перетаскивания -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.0/utils/Draggable.min.js"></script>
    
    <script src='{% static "MailApp/scripts.js" %}'></script>
    <script src='{% static "MailApp/options.js" %}'></script>
    <script>
        let max_mails = {{ max_mails }};
    	let send_mail = '{% url "send_mails" user.id %}';
        let create_mail = '{% url "create_mail" user.id %}';
        let change_status = '{% url "change_status" user.id %}';
    </script>
</body>

</html>
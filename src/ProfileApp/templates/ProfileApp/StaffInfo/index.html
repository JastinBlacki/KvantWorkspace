{% load base_tags %}
{% load admin_tags %}

<div class="card">

    <h1>Личные данные</h1>
    <div class="flex space-between items-center">
        <h3>Сотрудник</h3>
        <button class="standartButton" onclick="editTableStart(this, updateUserPersonalInfo)">
            <svg viewBox="0 0 512 512">
                <path d="M362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32zM421.7 220.3L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3z"/>
            </svg>
            Редактировать
        </button>
    </div>
    <div class="table">
        <div class="tableRow">
            <p>Фамилия Имя Отчество</p>
            <div class="tableCell">
                <svg viewBox="0 0 448 512">
                    <path d="M274.7 304H173.3C77.61 304 0 381.6 0 477.3c0 19.14 15.52 34.67 34.66 34.67h378.7C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304z"/>
                    <path style='opacity: .4' d="M352 128c0 70.69-57.3 128-128 128C153.3 256 96 198.7 96 128s57.31-128 128-128C294.7 0 352 57.31 352 128z"/>
                </svg>
                <input placeholder="Фамилия" readonly value="{{ requested_user.surname }}" id="staff-surname">
                <input placeholder="Имя" readonly value="{{ requested_user.name }}" id="staff-name">
                <input placeholder="Отчество" readonly value="{{ requested_user.patronymic }}" id="staff-patronymic">
            </div>
        </div>
        <div class="tableRow">
            <p>Дата рождения</p>
            <div class="tableCell">
                <svg viewBox="0 0 448 512">
                    <path d="M96 32C96 14.33 110.3 0 128 0C145.7 0 160 14.33 160 32V64H288V32C288 14.33 302.3 0 320 0C337.7 0 352 14.33 352 32V64H400C426.5 64 448 85.49 448 112V192H0V112C0 85.49 21.49 64 48 64H96V32z"/>
                    <path style='opacity: .4' d="M448 464C448 490.5 426.5 512 400 512H48C21.49 512 0 490.5 0 464V192H448V464zM80 256C71.16 256 64 263.2 64 272V368C64 376.8 71.16 384 80 384H176C184.8 384 192 376.8 192 368V272C192 263.2 184.8 256 176 256H80z"/></svg>
                <input placeholder="__.__.____" readonly value="{{ requested_user.staffpersonalinfo.date }}" id="staff-birth-date">
            </div>
        </div>
        <div class="tableRow">
            <p>Пол</p>
            <div class="tableCell">
                <svg viewBox="0 0 320 512">
                    <path d="M112 48C112 24.22 129.3 4.473 152 .6641V95.34C129.3 91.53 112 71.78 112 48V48zM152 480.2C151.9 497.8 137.6 512 120 512C102.3 512 88 497.7 88 480V384H70.2C59.28 384 51.57 373.3 55.02 362.9L93.28 248.1L59.43 304.5C50.33 319.6 30.67 324.5 15.52 315.4C.3696 306.3-4.531 286.7 4.573 271.5L58.18 182.3C78.06 149.2 113.5 128.8 152 128V480.2z"/>
                    <path style='opacity: .4' d="M174.9 128C208.6 128 239.8 145.7 257.2 174.6L315.4 271.5C324.5 286.7 319.6 306.3 304.5 315.4C289.3 324.5 269.7 319.6 260.6 304.5L232 256.9V480C232 497.7 217.7 512 200 512C182.3 512 168 497.7 168 480L168 128H174.9zM168 .6641C190.7 4.472 208 24.22 208 48C208 71.78 190.7 91.53 168 95.34V.6641z"/>
                </svg>
                <input placeholder="Пол" readonly value="{{ requested_user.staffpersonalinfo.sex }}" id="staff-sex">
            </div>
        </div>
        <div class="tableRow">
            <p>Электронная почта</p>
            <div class="tableCell">
                <svg viewBox="0 0 512 512">
                    <path d="M16.29 145.3l212.2 165.1c16.19 12.6 38.87 12.6 55.06 0l212.2-165.1C505.1 137.3 512 125 512 112C512 85.49 490.5 64 464 64h-416C21.49 64 0 85.49 0 112C0 125 6.01 137.3 16.29 145.3z"/>
                    <path style='opacity: .4' d="M511.1 120H512v280c0 26.51-21.49 48-48 48h-416C21.49 448 0 426.5 0 400V120h.9199c1.926 9.936 7.236 18.98 15.37 25.3l212.2 165.1c16.19 12.6 38.87 12.6 55.06 0l212.2-165.1C503.8 138.1 509.2 129.9 511.1 120z"/>
                </svg>
                <input placeholder="Электронная почта" readonly value="{{ requested_user.email }}" id="staff-email">
            </div>
        </div>
        <div class="tableRow">
            <p>Документ</p>
            <div class="tableCell">
                <svg viewBox="0 0 448 512">
                    <path d="M265.1 105.6C272.8 124.6 277.8 149 279.3 176h39.13C313.1 144.8 292.8 118.9 265.1 105.6zM129.6 208c5.25 31.25 25.62 57.13 53.25 70.38C175.3 259.4 170.3 235 168.8 208H129.6zM384 0H64C28.65 0 0 28.65 0 64v384c0 35.35 28.65 64 64 64h320c35.2 0 64-28.8 64-64V64C448 28.8 419.2 0 384 0zM336 416h-224C103.3 416 96 408.8 96 400S103.3 384 112 384h224c8.75 0 16 7.25 16 16S344.8 416 336 416zM224 320c-70.75 0-128-57.25-128-128s57.25-128 128-128s128 57.25 128 128S294.8 320 224 320zM129.6 176h39.13c1.5-27 6.5-51.38 14.12-70.38C155.3 118.9 134.9 144.8 129.6 176zM265.1 278.4c27.62-13.25 48-39.13 53.25-70.38h-39.13C277.8 235 272.8 259.4 265.1 278.4zM224 286.8C231.8 279.3 244.8 252.3 247.4 208H200.5C203.3 252.3 216.3 279.3 224 286.8zM200.6 176h46.88C244.7 131.8 231.8 104.8 224 97.25C216.3 104.8 203.2 131.8 200.6 176z"/>
                    <path style='opacity: .4' d="M224 64C153.3 64 96 121.3 96 192s57.25 128 128 128s128-57.25 128-128S294.8 64 224 64zM318.4 176h-39.13c-1.5-27-6.5-51.38-14.12-70.38C292.8 118.9 313.1 144.8 318.4 176zM129.6 208h39.13c1.5 27 6.5 51.38 14.12 70.38C155.3 265.1 134.9 239.3 129.6 208zM168.8 176H129.6c5.25-31.25 25.62-57.13 53.25-70.38C175.3 124.6 170.3 149 168.8 176zM224 286.8C216.3 279.3 203.3 252.3 200.5 208h46.84C244.8 252.3 231.8 279.3 224 286.8zM200.6 176C203.2 131.8 216.3 104.8 224 97.25C231.8 104.8 244.7 131.8 247.5 176H200.6zM265.1 278.4C272.8 259.4 277.8 235 279.3 208h39.13C313.1 239.3 292.8 265.1 265.1 278.4z"/>
                </svg>
                <input placeholder="Серия" readonly value="{{ requested_user.staffpersonalinfo.document.series }}" id="staff-series">
                <input placeholder="Номер" readonly value="{{ requested_user.staffpersonalinfo.document.number }}" id="staff-number">
                <input placeholder="Дата выдачи" readonly value="{{ requested_user.staffpersonalinfo.document.given_date }}" id="staff-given_date">
                <input placeholder="Кем выдан" readonly value="{{ requested_user.staffpersonalinfo.document.who_gave }}" id="staff-who_gave">
                <input placeholder="Код подразделения" readonly value="{{ requested_user.staffpersonalinfo.document.code }}" id="staff-code">
            </div>
        </div>
        <div class="tableRow">
            <p>Адрес проживания</p>
            <div class="tableCell">
                <svg viewBox="0 0 384 512">
                    <path d="M240 192C240 218.5 218.5 240 192 240C165.5 240 144 218.5 144 192C144 165.5 165.5 144 192 144C218.5 144 240 165.5 240 192z"/>
                    <path style='opacity: .6' d="M168.3 499.2C116.1 435 0 279.4 0 192C0 85.96 85.96 0 192 0C298 0 384 85.96 384 192C384 279.4 267 435 215.7 499.2C203.4 514.5 180.6 514.5 168.3 499.2H168.3zM192 272C236.2 272 272 236.2 272 192C272 147.8 236.2 112 192 112C147.8 112 112 147.8 112 192C112 236.2 147.8 272 192 272z"/>
                </svg>
                <input placeholder="Город" readonly value="{{ requested_user.staffpersonalinfo.adress.city }}" id="staff-city">
                <input placeholder="Улица" readonly value="{{ requested_user.staffpersonalinfo.adress.street }}" id="staff-street">
                <input placeholder="Дом" readonly value="{{ requested_user.staffpersonalinfo.adress.house_number }}" id="staff-house_number">
                <input placeholder="Квартира" readonly value="{{ requested_user.staffpersonalinfo.adress.room }}" id="staff-room">
            </div>
        </div>
        <div class="tableRow">
            <p>СНИЛС</p>
            <div class="tableCell">
                <svg viewBox="0 0 576 512">
                    <path d="M176 256c35.35 0 64-28.65 64-64s-28.65-64-64-64s-64 28.65-64 64S140.7 256 176 256zM208 288h-64C99.82 288 64 323.8 64 368C64 376.8 71.16 384 80 384h192c8.836 0 16-7.164 16-16C288 323.8 252.2 288 208 288z"/>
                    <path style='opacity: .4' d="M512 32H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h448c35.35 0 64-28.65 64-64V96C576 60.65 547.3 32 512 32zM176 128c35.35 0 64 28.65 64 64s-28.65 64-64 64s-64-28.65-64-64S140.7 128 176 128zM272 384h-192C71.16 384 64 376.8 64 368C64 323.8 99.82 288 144 288h64c44.18 0 80 35.82 80 80C288 376.8 280.8 384 272 384zM496 320h-128C359.2 320 352 312.8 352 304S359.2 288 368 288h128C504.8 288 512 295.2 512 304S504.8 320 496 320zM496 256h-128C359.2 256 352 248.8 352 240S359.2 224 368 224h128C504.8 224 512 231.2 512 240S504.8 256 496 256zM496 192h-128C359.2 192 352 184.8 352 176S359.2 160 368 160h128C504.8 160 512 167.2 512 176S504.8 192 496 192z"/>
                </svg>
                <input placeholder="___-___-___ __" readonly value="{{ requested_user.staffpersonalinfo.snils }}" id="staff-snils">
            </div>
        </div>
        <div class="tableRow">
            <p>Образование</p>
            <div class="tableCell">
                <svg viewBox="0 0 640 512">
                    <path d="M640 160c0 10.38-6.438 19.65-16.05 23.09l-282.7 101.2c-13.73 4.91-28.7 4.91-42.43 0L108.2 216.1C121.9 200.9 139.1 189.5 161 184.2l162.9-40.72c8.594-2.141 13.78-10.83 11.66-19.39c-2.125-8.594-10.97-13.89-19.41-11.64L153.3 153.2C121.4 161.2 94.6 179.8 76.07 204.6L16.05 183.1C6.438 179.6 0 170.4 0 160s6.438-19.65 16.05-23.09l282.7-101.2c13.73-4.91 28.7-4.91 42.43 0l282.7 101.2C633.6 140.4 640 149.6 640 160zM351.1 314.4C341.7 318.1 330.9 320 320 320c-10.92 0-21.69-1.867-32-5.555L142.8 262.5L128 405.3C128 446.6 213.1 480 320 480c105.1 0 192-33.4 192-74.67l-14.78-142.9L351.1 314.4z"/>
                    <path style='opacity: .4' d="M323.9 143.5L161 184.2C121.6 194.1 92.4 225 83.28 263.1C90.83 268.1 96 277.7 96 288c0 9.953-4.814 18.49-11.94 24.36l24.83 149C110.5 471.1 103 480 93.11 480H34.89c-9.887 0-17.41-8.879-15.78-18.63l24.83-149C36.81 306.5 32 297.1 32 288c0-13.24 8.047-24.61 19.52-29.47c11.02-50.84 49.58-92.28 101.7-105.3l162.9-40.72c8.438-2.25 17.28 3.047 19.41 11.64C337.7 132.7 332.5 141.4 323.9 143.5z"/>
                </svg>
                <input placeholder="ВПО/СПО" readonly value="{{ requested_user.staffpersonalinfo.study.vpo_spo }}" id="staff-vpo_spo">
                <input placeholder="ВУЗ" readonly value="{{ requested_user.staffpersonalinfo.study.vuz }}" id="staff-vuz">
                <input placeholder="Специальность" readonly value="{{ requested_user.staffpersonalinfo.study.speciality }}" id="staff-speciality">
                <input placeholder="Квалификация" readonly value="{{ requested_user.staffpersonalinfo.study.qualification }}" id="staff-qualification">
                <input placeholder="Год выпуска" readonly value="{{ requested_user.staffpersonalinfo.study.year }}" id="staff-year">
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h1>Загрузка документов</h1>

    <h3>Паспорт</h3>
    {% if requested_user.staffpersonalinfo.scans.document %}
        {% include "CoreApp/FileView/index.html" with files=requested_user.staffpersonalinfo.scans.document|wrap delete=True file_selector='document' %}
    {% else %}
        <button class='secondaryButton' type="button" style="align-self: start" onclick="openFileDialog('#document-input')">
            <svg viewBox="0 0 14.666 16">
                <g transform="translate(-8.667 -8)">
                    <path opacity='0.3' d="M10.667,12.5a3.171,3.171,0,0,1,3.167-3.167h6.089A1.832,1.832,0,0,0,18.167,8H10.5A1.835,1.835,0,0,0,8.667,9.833V20.166A1.835,1.835,0,0,0,10.5,22h.167Z"/>
                    <path d="M21.5,10.667H13.833A1.835,1.835,0,0,0,12,12.5v9.667A1.835,1.835,0,0,0,13.833,24H21.5a1.835,1.835,0,0,0,1.833-1.833V12.5A1.835,1.835,0,0,0,21.5,10.667ZM20.167,22h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.333h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Z"/>
                </g>
            </svg>
            Прикрепить файл
        </button>
        <input id="document-input" type="file" style="display: none;" onchange='updateStaffScans(event, "document")' accept="application/msword, application/pdf, image/*"/>
    {% endif %}

    <h3>СНИЛС</h3>
    {% if requested_user.staffpersonalinfo.scans.snils %}
        {% include "CoreApp/FileView/index.html" with files=requested_user.staffpersonalinfo.scans.snils|wrap delete=True file_selector='snils' %}
    {% else %}
        <button class='secondaryButton' type="button" style="align-self: start" onclick="openFileDialog('#snils-input')">
            <svg viewBox="0 0 14.666 16">
                <g transform="translate(-8.667 -8)">
                    <path opacity='0.3' d="M10.667,12.5a3.171,3.171,0,0,1,3.167-3.167h6.089A1.832,1.832,0,0,0,18.167,8H10.5A1.835,1.835,0,0,0,8.667,9.833V20.166A1.835,1.835,0,0,0,10.5,22h.167Z"/>
                    <path d="M21.5,10.667H13.833A1.835,1.835,0,0,0,12,12.5v9.667A1.835,1.835,0,0,0,13.833,24H21.5a1.835,1.835,0,0,0,1.833-1.833V12.5A1.835,1.835,0,0,0,21.5,10.667ZM20.167,22h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.333h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Z"/>
                </g>
            </svg>
            Прикрепить файл
        </button>
        <input id="snils-input" type="file" style="display: none;" onchange='updateStaffScans(event, "snils")' accept="application/msword, application/pdf, image/*"/>
    {% endif %}

    <h3>Документ об образовании</h3>
    {% if requested_user.staffpersonalinfo.scans.study %}
        {% include "CoreApp/FileView/index.html" with files=requested_user.staffpersonalinfo.scans.study|wrap delete=True file_selector='study' %}
    {% else %}
        <button class='secondaryButton' type="button" style="align-self: start" onclick="openFileDialog('#study-input')">
            <svg viewBox="0 0 14.666 16">
                <g transform="translate(-8.667 -8)">
                    <path opacity='0.3' d="M10.667,12.5a3.171,3.171,0,0,1,3.167-3.167h6.089A1.832,1.832,0,0,0,18.167,8H10.5A1.835,1.835,0,0,0,8.667,9.833V20.166A1.835,1.835,0,0,0,10.5,22h.167Z"/>
                    <path d="M21.5,10.667H13.833A1.835,1.835,0,0,0,12,12.5v9.667A1.835,1.835,0,0,0,13.833,24H21.5a1.835,1.835,0,0,0,1.833-1.833V12.5A1.835,1.835,0,0,0,21.5,10.667ZM20.167,22h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.333h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Z"/>
                </g>
            </svg>
            Прикрепить файл
        </button>
        <input id="study-input" type="file" style="display: none;" onchange='updateStaffScans(event, "study")' accept="application/msword, application/pdf, image/*"/>
    {% endif %}

    <h3>Смена фамилии</h3>
    {% if requested_user.staffpersonalinfo.scans.surname_change %}
        {% include "CoreApp/FileView/index.html" with files=requested_user.staffpersonalinfo.scans.surname_change|wrap delete=True file_selector='surname_change' %}
    {% else %}
        <button class='secondaryButton' type="button" style="align-self: start" onclick="openFileDialog('#surname_change-input')">
            <svg viewBox="0 0 14.666 16">
                <g transform="translate(-8.667 -8)">
                    <path opacity='0.3' d="M10.667,12.5a3.171,3.171,0,0,1,3.167-3.167h6.089A1.832,1.832,0,0,0,18.167,8H10.5A1.835,1.835,0,0,0,8.667,9.833V20.166A1.835,1.835,0,0,0,10.5,22h.167Z"/>
                    <path d="M21.5,10.667H13.833A1.835,1.835,0,0,0,12,12.5v9.667A1.835,1.835,0,0,0,13.833,24H21.5a1.835,1.835,0,0,0,1.833-1.833V12.5A1.835,1.835,0,0,0,21.5,10.667ZM20.167,22h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.333h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Zm0-2.667h-5a.5.5,0,0,1,0-1h5a.5.5,0,0,1,0,1Z"/>
                </g>
            </svg>
            Прикрепить файл
        </button>
        <input id="surname_change-input" type="file" style="display: none;" onchange='updateStaffScans(event, "surname_change")' accept="application/msword, application/pdf, image/*"/>
    {% endif %}

</div>

<script>
    function editTableConfirm(button, func, type){
        sendInstanceData(func(type), '{% url "update_user" requested_user.id %}', button)
    }
</script>

<script>
    function deleteFunction(file_selector){
        $.ajax({
            type: 'POST',
            url: "{% url 'delete_scans' requested_user.id %}",
            data: {
                scan: file_selector,
                csrfmiddlewaretoken: getCookie('csrftoken'),
            },
            cache: false,
            success: function(respose){ location.reload() }
        })
    }
</script>

<script>
    function updateUserPersonalInfo(){
        let user_form = new FormData(); 

        user_form.append('type', 'staff')

        user_form.append('surname', $('#staff-surname').val())
        user_form.append('name', $('#staff-name').val())
        user_form.append('patronymic', $('#staff-patronymic').val())
        user_form.append('date', $('#staff-birth-date').val())
        user_form.append('sex', $('#staff-sex').val())
        user_form.append('series', $('#staff-series').val())
        user_form.append('number', $('#staff-number').val())
        user_form.append('given_date', $('#staff-given_date').val())
        user_form.append('who_gave', $('#staff-who_gave').val())
        user_form.append('code', $('#staff-code').val())
        user_form.append('city', $('#staff-city').val())
        user_form.append('street', $('#staff-street').val())
        user_form.append('house_number', $('#staff-house_number').val())
        user_form.append('room', $('#staff-room').val())
        user_form.append('snils', $('#staff-snils').val())
        user_form.append('email', $('#staff-email').val())
        user_form.append('vpo_spo', $('#staff-vpo_spo').val())
        user_form.append('vuz', $('#staff-vuz').val())
        user_form.append('speciality', $('#staff-speciality').val())
        user_form.append('qualification', $('#staff-qualification').val())
        user_form.append('year', $('#staff-year').val())

        user_form.append('csrfmiddlewaretoken', getCookie('csrftoken'))

        return user_form
    }
</script>

<script>
    function updateStaffScans(event, data){
        if(event.target.files[0] !== undefined){
            let user_form = new FormData(); 

            user_form.append('type', 'staff_scans')
            user_form.append(data, event.target.files[0])
            user_form.append('csrfmiddlewaretoken', getCookie('csrftoken'))

            sendInstanceData(user_form, '{% url "update_user" requested_user.id %}', $('<button/>'))
        }
    }
</script>
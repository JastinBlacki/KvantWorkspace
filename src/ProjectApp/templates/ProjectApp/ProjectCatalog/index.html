{% load static %}
{% load base_tags %}
{% load project_tags %}

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    {% include "CoreApp/HeadSetup/index.html" %}
    <link rel='stylesheet' href='{% static "CoreApp/icons/files/file-icons.css" %}'/>
    <link rel="stylesheet" href='{% static "ProjectApp/ProjectCatalog/style.css" %}'> <!-- Стили страницы -->
    
    <title>Проекты</title>
</head>

<body>

    {% include "CoreApp/AsideMenu/index.html" with user=user active='project_page' %}

    <div class="mainContainer">

        <header  class="header">
            <h1>Проекты</h1>
            <button class="secondaryButton">
                <svg viewBox="0 0 512 512">
                    <path d="M512 24V160c0 12.94-7.781 24.61-19.75 29.56c-12 4.906-25.72 2.203-34.88-6.938L416 141.3l-201.4 201.4C208.4 348.9 200.2 352 192 352s-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L370.8 96l-41.38-41.38c-9.156-9.156-11.91-22.91-6.938-34.88C327.4 7.797 339.1 0 352 0h136C501.3 0 512 10.74 512 24z"/>
                    <path style='opacity: .6' d="M384 320c-17.67 0-32 14.33-32 32v96H64V160h96c17.67 0 32-14.32 32-32s-14.33-32-32-32L64 96c-35.35 0-64 28.65-64 64V448c0 35.34 28.65 64 64 64h288c35.35 0 64-28.66 64-64v-96C416 334.3 401.7 320 384 320z"/>
                </svg>
                Мои проекты
            </button>
        </header>
        
        <div class="projectCatalog">
            <div class="filter">
                <div id="search">
                    <input autocomplete="off" placeholder="Поиск" id="searchInput">
                    <svg viewBox="0 0 512 512" onclick="location.href = updateGetUrlParams('search', $('#searchInput').val())">
                        <path d="M500.3 443.7l-119.7-119.7c-15.03 22.3-34.26 41.54-56.57 56.57l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7z"/>
                        <path style='opacity: .8' d="M207.1 0C93.12 0-.0002 93.13-.0002 208S93.12 416 207.1 416s208-93.13 208-208S322.9 0 207.1 0zM207.1 336c-70.58 0-128-57.42-128-128c0-70.58 57.42-128 128-128s128 57.42 128 128C335.1 278.6 278.6 336 207.1 336z"/>
                    </svg>
                </div>

                <div class="menu">
                    <div class="menu__button {{ request.GET.subject|get_active_btn:'all' }}" onclick="location.href= updateGetUrlParams('subject', 'all')">
                        <svg viewBox="0 0 448 512">
                            <path d="M255.1 255.1c0 17.63-14.38 32-32 32s-32-14.37-32-32c0-17.62 14.38-32.03 32-32.03S255.1 238.3 255.1 255.1z"/>
                            <path style='opacity: .6' d="M423.1 56.87C379.1 12.86 300.3 31.62 224 79.12C147.6 31.62 68.87 12.86 24.87 56.87C-19.14 100.9-.3849 179.6 47.12 256c-47.5 76.38-66.25 155.1-22.25 199.1C66.12 496.4 140.4 484.5 224 432.5c83.25 51.88 157.8 64 199.1 22.63c44-44 25.25-122.8-22.25-199.1C448.4 179.6 467.1 100.9 423.1 56.87zM70.12 102.1c9.316-9.316 39.67-12.54 97.26 17.88c-29 23.75-55.5 50.25-79.13 79.13C63.37 151.9 57.74 114.5 70.12 102.1zM70.12 409.9c-12.38-12.38-6.751-49.75 18.13-97.01c28.75 34.88 53 57.38 79.13 78.88C119.1 416.6 82.49 422.3 70.12 409.9zM224 355c-44.88-34.25-73-65-98.88-99.01C153.4 218.5 186.6 184.1 224 156.6c37.38 28.38 70.63 61.88 99 99.38C288.8 300.9 258 329 224 355zM377.9 409.9c-12.38 12.38-49.88 6.75-97.26-18.13c26-21.5 50.25-43.88 79.13-78.88C384.6 360.1 390.3 397.5 377.9 409.9zM359.8 199.1c-23.62-28.88-50.13-55.38-79.13-79.13c57.33-30.29 87.89-27.24 97.26-17.88C390.3 114.5 384.6 151.9 359.8 199.1z"/>
                        </svg>
                        <p>Все</p>
                    </div>
                    {% for subject in subjects %}
                    <div class="menu__button {{ request.GET.subject|get_active_btn:subject.name }}" onclick="location.href= updateGetUrlParams('subject', '{{ subject.name }}')">
                        <svg viewBox="0 0 640 512" class="lesson__illustration">
                            <path d="M518.6 121.4L630.6 233.4C643.1 245.9 643.1 266.1 630.6 278.6L518.6 390.6C506.1 403.1 485.9 403.1 473.4 390.6C460.9 378.1 460.9 357.9 473.4 345.4L562.7 256L473.4 166.6C460.9 154.1 460.9 133.9 473.4 121.4C485.9 108.9 506.1 108.9 518.6 121.4V121.4zM166.6 166.6L77.25 256L166.6 345.4C179.1 357.9 179.1 378.1 166.6 390.6C154.1 403.1 133.9 403.1 121.4 390.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4L121.4 121.4C133.9 108.9 154.1 108.9 166.6 121.4C179.1 133.9 179.1 154.1 166.6 166.6V166.6z"/>
                            <path style='opacity: .4' d="M414.8 40.79L286.8 488.8C281.9 505.8 264.2 515.6 247.2 510.8C230.2 505.9 220.4 488.2 225.2 471.2L353.2 23.21C358.1 6.216 375.8-3.624 392.8 1.232C409.8 6.087 419.6 23.8 414.8 40.79z"/>
                        </svg>
                        <p>{{ subject.name }}</p>
                    </div>
                    {% endfor %}
                </div>

                <div class="filtering">
                    <div class="dropdownSelect">
                        <h3>Статус</h3>
                        <div class="dropdownSelect__trigger">
                            
                            {% if request.GET.filter == 'all' %}
                            <div>Все</div>
                            {% elif request.GET.filter == 'hiring' %}
                            <div>Набирающие участников</div>
                            {% elif request.GET.filter == 'active' %}
                            <div>Активные</div>
                            {% elif request.GET.filter == 'closed' %}
                            <div>Завершенные</div>
                            {% endif %}
                            
                            <div class="arrowDown"></div>
                        </div>
                        <div class="dropdownSelect__options">
                            <span class='dropdownSelect__option {{ request.GET.filter|get_selected_btn:"all" }}' onclick="location.href= updateGetUrlParams('filter', 'all')">Все</span>
                            <span class='dropdownSelect__option {{ request.GET.filter|get_selected_btn:"hiring" }}' onclick="location.href= updateGetUrlParams('filter', 'hiring')">Набирающие участников</span>
                            <span class='dropdownSelect__option {{ request.GET.filter|get_selected_btn:"active" }}' onclick="location.href= updateGetUrlParams('filter', 'active')">Активные</span>
                            <span class='dropdownSelect__option {{ request.GET.filter|get_selected_btn:"closed" }}' onclick="location.href= updateGetUrlParams('filter', 'closed')">Завершенные</span>
                        </div>
                    </div>
                </div>

            </div>

            <section class="projects">
                
                {% for project in projects %}
                <div class="project" onclick="location.href = `{% url 'project_info' project.id %}`">
                    <img src="{{ project.image.url }}" class="project__illustration">
                    <div class="project__content">
                        <p class="project__title">{{ project.title }}</p>
                        
                        <div class="ql-snow">
                            <div class="ql-editor">
                                <p class="project__description">{{ project.description|get_text }}</p>
                            </div>
                        </div>

                        <div class="project__info">
                            <div class="column g8">
                                <p>Направление</p>
                                
                                {% for subject in project.course_subject|get_objects %}
                                <span class="tag">{{ subject.name }}</span>
                                {% endfor %}

                            </div>
                            <div class="column g8">
                                <p>Статус</p>
                                <span class="tag">{{ project|get_type }}</span>
                            </div>

                            <div class="column g8">
                                <p>Участники</p>
                                <div class="project__members members">
                                    <div class="member" title="Фамилия Имя">
                                        <img src="{{ project.teamleader.image.url }}" class="avatar">
                                    </div>

                                    {% for user in project.team|get_objects %}
                                    <div class="member" title="Фамилия Имя">
                                        <img src="{{ user.image.url }}" class="avatar">
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <div class="pagination row g16">
                    
                    {% if page_obj.has_previous  %}
                    <button class="combinedButton" onclick='location.href = updateGetUrlParams("page", "{{ page_obj.previous_page_number }}")'>
                        <svg viewBox="0 0 14 14" style='transform: rotate(180deg)'>
                            <g transform="translate(-5 -5)">
                                <rect width="2" height="14" rx="1" transform="translate(5 13) rotate(-90)" opacity='0.3'/>
                                <path d="M9.707-15.707a1,1,0,0,0-1.414,0,1,1,0,0,0,0,1.414l6,6a1,1,0,0,0,1.383.03l6-5.5a1,1,0,0,0,.062-1.413,1,1,0,0,0-1.413-.061L15.03-10.384Z" transform="translate(27 27) rotate(-90)"/>
                            </g>
                        </svg>
                    </button>
                    {% endif  %}

                    <p class='pagination__page'>{{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</p>
                    
                    {% if page_obj.has_next %}
                    <button class="combinedButton" onclick='location.href = updateGetUrlParams("page", "{{ page_obj.next_page_number }}")'>
                        <svg viewBox="0 0 14 14">
                            <g transform="translate(-5 -5)">
                                <rect width="2" height="14" rx="1" transform="translate(5 13) rotate(-90)" opacity='0.3'/>
                                <path d="M9.707-15.707a1,1,0,0,0-1.414,0,1,1,0,0,0,0,1.414l6,6a1,1,0,0,0,1.383.03l6-5.5a1,1,0,0,0,.062-1.413,1,1,0,0,0-1.413-.061L15.03-10.384Z" transform="translate(27 27) rotate(-90)"/>
                            </g>
                        </svg> 
                    </button>
                    {% endif %}
                </div>
            </section>

        </div>
    </div>

    <div id="arrowTop" hidden>
        <svg viewBox="0 0 14 14">
            <g transform="translate(-5 -5)">
                <rect width="2" height="14" rx="1" transform="translate(5 13) rotate(-90)" opacity='0.3'/>
                <path d="M9.707-15.707a1,1,0,0,0-1.414,0,1,1,0,0,0,0,1.414l6,6a1,1,0,0,0,1.383.03l6-5.5a1,1,0,0,0,.062-1.413,1,1,0,0,0-1.413-.061L15.03-10.384Z" transform="translate(27 27) rotate(-90)"/>
            </g>
        </svg> 
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> <!-- JQuery -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{% static 'CoreApp/text/options.js' %}"></script>
    <script src="{% static 'CoreApp/drop/dropdownSelect.js' %}"></script> <!-- Выпадающие меню -->
    
    <script>
        $(".menu__button").on("click", function(){
            $(this).parent().find(".menu__button").removeClass("active");
            $(this).toggleClass("active", "inactive");
        });
    </script>
</body>

</html>
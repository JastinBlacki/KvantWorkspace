{% load static %}
{% load base_tags %}
{% load news_tags %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    
    {% include "CoreApp/HeadSetup/index.html" %}
    <link rel='stylesheet' href='{% static "CoreApp/icons/files/file-icons.css" %}'/>
    <link rel="stylesheet" href='{% static "NewsApp/MainPage/style.css" %}'> <!-- –°—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <link rel="stylesheet" href='{% static "CoreApp/text/ql-editor.css" %}'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css"/> <!-- –°–ª–∞–π–¥–µ—Ä -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.9/dist/katex.min.css" integrity="sha384-r/BYDnh2ViiCwqZt5VJVWuADDic3NnnTIEOv4hOh05nSfB6tjWpKmn1kUHOVkMXc" crossorigin="anonymous"> <!-- –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª -->

    <title>–ì–ª–∞–≤–Ω–∞—è</title>
</head>

<body onload="getNewNews();">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
    {% include "CoreApp/AsideMenu/index.html" with user=user active='main_page' %}
    
    <section class="mainContainer column">

        <div class='row g24'>
            <h1>–ì–ª–∞–≤–Ω–∞—è</h1>
            {% if user.permission != '–£—á–µ–Ω–∏–∫' %}
            <button class='secondaryButton' onclick="open_form('#newEventForm')">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            {% endif %}
        </div>

        <!-- –í–∏–¥–∂–µ—Ç—ã -->
        <section id='widgets' class='row g16'>

            <!-- –í–∏–¥–∂–µ—Ç "–ö–∞–ª–µ–Ω–¥–∞—Ä—å" -->
            
            <div id="eventsWidget">
                
                <div id="eventCarousel" class="carousel">
                    {% for event in events %}
                    <div class="carousel__slide event">
                        <img src="{{ event.image.url }}" class='event__banner'>
                        <div class="event__content column g16">
                            <p class="event__tag">–°–æ–±—ã—Ç–∏–µ</p>
                            <h2 class="event__title">{{ event.title }}</h2>
                            <p class="event__text">{{ event.content|get_text }}</p>
                            <button class="event__button" onclick="location.href=`{% url 'detail_news' event.id %}`">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- –í–∏–¥–∂–µ—Ç "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" -->
            {% include "NewsApp/CourseShedule/index.html" with courses=courses %}  
        </section>
        
        <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
        <section id='news' class='column g24'>

            <div class='row g24'>
                <h1>–ù–æ–≤–æ—Å—Ç–∏</h1>
                {% if user.permission != '–£—á–µ–Ω–∏–∫' %}
                <button class='secondaryButton' onclick="open_form('#newNewsItemForm')">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
                {% endif %}
                <!-- <input type="text" class='newsSearch' placeholder="üîçÔ∏é"> -->
            </div>

            <!-- –ë–ª–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π -->
            <div id='news__container' class='newsContainer'>
                <!-- –°–ø–∞–≤–Ω –Ω–æ–≤—Å–æ—Ç–µ–π :\ -->
            </div>
            
            <button onclick="getNewNews()" class='primaryButton' style='margin: 0 auto' id='more'>–ë–æ–ª—å—à–µ –Ω–æ–≤–æ—Å—Ç–µ–π</button>
            {% include "NewsApp/NewsCreationForm/index.html" with form_status="create" %}
            {% include "NewsApp/EventCreationForm/index.html" %}
        </section>
    </section>
    
    <div class="alertsContainer column" id='alertsContainer'></div>
    
    <script src="{% static 'NewsApp/MainPage/scripts.js' %}"></script>
    <script src="{% static 'NewsApp/Core/scripts.js' %}"></script>
    <script src="{% static 'NewsApp/EventForm/scripts.js' %}"></script>
    
    <!-- –°–∞–º–∞ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="{% static 'CoreApp/text/options.js' %}"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script>

    <script> initQuill('#event-editor') </script>
    
    <script>
        const news_per_page_num = 8;
        const all_news = parseInt('{{ max_news }}');
        
        function getNewNews(){
            $.ajax({
                type: 'GET',
                url: `{% url "send_news" %}`,
                data: {'page': page},
                cache: false,
                success: function(response){
                    $('#news__container').append(response);
                    if(page * news_per_page_num >= all_news)  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –µ—â–µ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                        $("#more")[0].style.display = 'none';
                    page++
                }
            })
        }
    </script>
    <script>
        const myCarousel = new Carousel(document.querySelector("#eventCarousel"), {
            Dots: true,
            infinite: true,
            friction: 0.9,
        });
        setInterval(() => myCarousel.slideTo(myCarousel.pageIndex + 1), 10000)
    </script>
</body>
</html>